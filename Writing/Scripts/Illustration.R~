# CREATED 19 January 2011
# PURPOSE illustrate concepts used for stock assessment with some diagrams

##### Illustrate the exponential decay with constant M and F

postscript(file = "../Graphics/IllustrationOfExpDecay.ps")

# Define parameters
N0 <- 1e3
Z <- 0.6

# Exponential decay function
f <- function(x) return(N0 * exp(- Z * x))

# function to illustrate the location of the number at age
d.n.a <- function(x = f(seq(0,5))){
for( i in 1:length(x)){

segments(i-1,0,i-1,x[i],lty=2)
arrows(ifelse(i <= 2, i + 0.5, i-0.5), x[i], i-0.9, x[i], length = 0.05)
text(ifelse(i <= 2, i + 0.6, i - 0.2), x[i], bquote(N[.(i - 1)]), pos = 4)

}
}

###### Plot
curve(f, from = 0, to = 10, las = 1, xlab = "Time (t)", ylab = "Number")

# Display death
polygon(c(seq(0,1,length=10), 1, 0), c(f(seq(0,1,length=10)), f(0), f(0)),  density = 10, col = "gray")
arrows(1.5, 0.9 * N0, 0.6, 0.9 * N0, length = 0.05)
text(1.6, 0.9 * N0, expression(T[0 %->% 1] == C[0 %->% 1] + D[0 %->% 1]), pos = 4)
# display number at age
d.n.a()

dev.off()

##### Illustrate the exponential decay with constant M and F varying according to selectivity

# Define parameters
S <- c(0,0.25,0.5,0.75,1)
N0 <- 1e3
M <- 0.2
F <- 2

# A curve composed of many exponential functions
f <- function(x) {
  # Output
  fx <- rep(NA, length(x))

  # Exponential decay by slice
  for(i in 1:length(x)){

    if( x[i] >= 0 && x[i] < 1) fx[i] <- N0 * exp(-(M + F * S[1]) * x[i])
    if( x[i] >= 1 && x[i] < 2) fx[i] <- N0 * exp(-(M + F * S[1]) * 1) * exp(-(M + F * S[2]) * (x[i]-1))
    if( x[i] >= 2 && x[i] < 3) fx[i] <- N0 * exp(-(M + F * S[1] + M + F * S[2]) * 1) * exp(-(M + F * S[3]) * (x[i] - 2))
    if( x[i] >= 3 && x[i] < 4) fx[i] <- N0 * exp(-(M + F * S[1] + M + F * S[2] + M + F * S[3]) * 1) * exp(-(M + F * S[4]) * (x[i] - 3))
    if( x[i] >= 4 && x[i] < 5) fx[i] <- N0 * exp(-(4 * M + F * sum(S[1:4])) * 1) * exp(-(M + F * S[5]) * (x[i] - 4))
                  
                }
  #
  return(fx)
}

##### Plots

### Exponential curve
postscript(file = "../Graphics/IllustrationOfExpDecayWithSelectivity.ps")
curve(f, from = 0, to = 5, las = 1, xlab = "Time (t)", ylab = "Number")

# Display death, only death from natural causes
polygon(c(seq(0,1,length=10), 1, 0), c(f(seq(0,1,length=10)), f(0), f(0)),  density = 10, col = "gray")
segments(1.5, 0.95 * N0, 0.6, 0.95 * N0); points(0.6, 0.95 * N0, pch = 19)
text(1.6, 0.95 * N0, expression(T[0 %->% 1] == D[0 %->% 1]), pos = 4)

# Display death, both natural and fishing mortality
polygon(c(seq(1,2,length=10), 2, 1), c(f(seq(1,2,length=10)), f(1), f(1)),  density = 10, col = "gray")
segments(2.5, 0.7 * N0, 1.8, 0.7 * N0); points(1.8, 0.7 * N0, pch = 19)
text(2.6, 0.7 * N0, expression(T[1 %->% 2] == C[1 %->% 2] + D[1 %->% 2]), pos = 4)

d.n.a()
curve(f, from = 0, to = 5, las = 1, xlab = "Time (t)", ylab = "Number", add = TRUE) # Redraw to make line black
dev.off()

### Selectivity curve
postscript(file = "../Graphics/IllustrationOfSelectivityAtAge.ps")
plot(seq(0,5), c(S,1), type = "s", xlab = "Time (t)", ylab = "Selectivity at age", las = 1)     

dev.off()
